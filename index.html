<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather App</title>
  <!-- <link rel="icon" type="image/png" href="./assets/sun.png"> -->
  <link rel="icon" type="image/png" href="./assets/rainy-day.png">

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <div id="main">

    <div id="app">
      <div class='grid_container'>
        <h1 id="page_title">Environment Monitoring</h1>

        <div class="data">

          <div class="item temperature">
            <h2>Temperature</h2>
            <p class="big-font" id="dash_temp">50 Â°C</p>
          </div>

          <div class="item air-quality">
            <h2>Air Quality</h2>

            <!-- <div class="air-quality-slider></div> -->
            <!-- <p class=" big-font">${airQuality} ppm</p> -->
            <p class="big-font" id="dash_aq">500</p>
          </div>

          <div class="item humidity">
            <h2>Humidity</h2>
            <p class="big-font" id="dash_hum">50 %</p>
          </div>

        </div>

        <div id="aligner"></div>
      </div>
    </div>

    <!-- <div id="delete_later">
      <button onclick="activate_error_box(true, false)">Fire</button>
      <button onclick="activate_error_box(false, true)">Gas</button>
      <button onclick="activate_error_box(true, true)">Both</button>
    </div> -->

    <br />
    <p> Temperature Graph</p>
    <div class="hname">
      <div id="temp" class="plot2d"></div>
      <div id="gap"></div>

      <p> Humidity Graph</p>
      <div id="hum" class="plot2d"></div>
      <div id="gap"></div>

      <p> Air Quality Graph</p>
      <div id="airquality" class="plot2d"></div>
      <div id="gap"></div>

      <p> Feels Like Temperature Graph</p>
      <div id="feel" class="plot2d"></div>
      <div id="gap"></div>

      <p> <label> Temperature and Humidity vs Temperature Feel </label> </p>
      <div id="Div" class="plot3d"></div>
      <div id="gap"></div>

      <p> <label> Temperature Feel and Humidity Vs Air Quality </label> </p>
      <div id="mydiv" class="plot3d"></div>
      <div id="gap"></div>

    </div>

    <div id="bottom">
      <p id="last_updated" title="Click to stop fetching data."></p>
      <hr>

      <p id="copyrights">
        &COPY;
        <span id="prof_basil"> Basil Skaria</span>,
        <span id="prof_bhushan"> Bhushan Songire &#128279;</span>,
        <span id="prof_ujjawal"> Ujjawal Kumar</span>,
        <span id="prof_vedant"> Vedant Choudhari,</span>
        <span id="copy_time"> (May 2024) </span>
      </p>
    </div>

  </div>

  <div id="errBox">
    <h2>Emergency Warning</h2>
    <h3 id="warning_title"></h3>
    <h3 id="warning_detail"></h3>
    <h2 id="pol">Police Number: 112</h2>
    <h2 id="amb">Ambulance Number: 108</h2>
    <button type="button" onclick="activate_error_box(false, false)">Close</button>
  </div>

  <!-- Main renderer -->
  <script src="./dashboard.js"></script>

  <!-- 2D plots -->
  <script src="./plot_humidity.js"> </script>
  <script src="./plot_feels_like.js"> </script>
  <script src="./plot_air_quality.js"> </script>
  <script src="./plot_temperature.js"></script>

  <!-- 3D plots -->
  <script src="./plotly_AQHum.js"> </script>
  <script src="./plotly_HumTemp.js"></script>

  <!-- SOS -->
  <script src="./trigger_error.js"></script>


  <script>
    var bs_obj_global;
    var data_fetch_status = true;
    var get_firebase_node;
  </script>

  <!-- base script -->
  <script>
    const prof_bs = document.getElementById('prof_bhushan');

    prof_bs.style.cursor = 'pointer';
    prof_bs.title = "Click to visit my profile";

    prof_bs.addEventListener('click', () => {
      window.open('https://www.linkedin.com/in/bhushan-songire', '_blank');
    })

  </script>

  <!-- initially plotting things: -->
  <script type="module">
    import { bs_obj } from "./initial_readings.js";

    // Update the readings in dashboard boxes:
    updateReadings(
      bs_obj.bs_temp[bs_obj.bs_temp.length - 1],
      bs_obj.bs_hum[bs_obj.bs_hum.length - 1],
      bs_obj.bs_mq135[bs_obj.bs_mq135.length - 1],
    );

    plot2_temperature(bs_obj.bs_temp);
    plot2_humidity(bs_obj.bs_hum);
    plot2_air_quality(bs_obj.bs_mq135);
    plot2_feels_like(bs_obj.bs_feel);
    plot3_hum_temp(bs_obj.bs_temp, bs_obj.bs_hum, bs_obj.bs_feel);
    plot3_aq_hum(bs_obj.bs_feel, bs_obj.bs_hum, bs_obj.bs_mq135);

    bs_obj_global = bs_obj;
  </script>

  <!-- Getting real time data and plotting that: -->
  <script type="module">
    import { login, get_data, var_random } from './fb_main.js';
    console.log("Imported test_variable: ", var_random);

    async function get_firebase_node() {
      // console.log("Reached the function required!!!");
      var bs_obj = await get_data();
      bs_obj_global = bs_obj;

      plot2_temperature(bs_obj.bs_temp);
      plot2_humidity(bs_obj.bs_hum);
      plot2_air_quality(bs_obj.bs_mq135);
      plot2_feels_like(bs_obj.bs_feel);
      plot3_hum_temp(bs_obj.bs_temp, bs_obj.bs_hum, bs_obj.bs_feel);
      plot3_aq_hum(bs_obj.bs_feel, bs_obj.bs_hum, bs_obj.bs_mq135);

      updateReadings(
        bs_obj.bs_temp[bs_obj.bs_temp.length - 1],
        bs_obj.bs_hum[bs_obj.bs_hum.length - 1],
        bs_obj.bs_mq135[bs_obj.bs_mq135.length - 1],
      );

      activate_error_box(bs_obj.bs_fire, bs_obj.bs_gas);
    }

    const fid = window.prompt("Enter firebase Id: ");
    const fpw = window.prompt("Enter firebase Pass: ");
    login(fid, fpw);


    // Part to handle the update on screen and toggle the data fetch..
    var stamp = document.getElementById("last_updated");
    const fetch_interval = 10 * 1000;
    // 10 sec

    function toggleFetchingData() {
      if (data_fetch_status) {
        clearInterval(interval_id);
        console.log('Stopped fetching data.')
        stamp.style.color = 'grey';
        stamp.title = "Not fetching the live data from server!"
      } else {
        interval_id = setInterval(get_firebase_node, fetch_interval);
        console.log('Resumed fetching data.')
        stamp.style.color = '#FB9039';
        stamp.title = "Fetching the live data from server!"
      }
      data_fetch_status = !data_fetch_status; // Toggle data_fetch_status
    }

    // Initialize data fetching
    var interval_id = setInterval(get_firebase_node, fetch_interval);
    stamp.addEventListener('click', toggleFetchingData);
  </script>

</body>

</html>